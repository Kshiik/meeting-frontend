(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[105],{505:(t,e,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/timeline",function(){return a(5463)}])},1640:(t,e,a)=>{"use strict";a.d(e,{lh:()=>m,SX:()=>g,y$:()=>p,qM:()=>u});var n=a(3266),o=a(4493),i=a(3495),r=a(6559),c=a(183),l=a(9748),s=a(6373),d=a(2572);let h={day:i.A,week:r.A,month:c.A,year:l.A},p=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let e=new URLSearchParams;t.roomId&&e.append("room_id",t.roomId.toString()),t.name&&e.append("name",t.name),t.type&&e.append("type",t.type),t.date&&e.append("date",t.date),t.officeId&&e.append("office_id",t.officeId.toString());let a="http://127.0.0.1:8000/api/event?".concat(e.toString());console.log("Запрос:",a);let i=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!i.ok){let t=await i.text();throw Error("Ошибка: ".concat(i.status," - ").concat(t))}let r=(await i.json()).data.map(t=>{let e=new Date("".concat(t.date,"T").concat(t.timeStart,"Z")),a=new Date("".concat(t.date,"T").concat(t.timeEnd,"Z")),n=t=>t.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/,/g,"");return{...t,timeStart:n(e),timeEnd:n(a)}}),l=function(t){let e=new Date,a=(0,c.A)(e,24),n=[];for(let e of t){if(e.recurrenceParent)continue;n.push(e);let{recurrenceTypeValue:t,recurrenceInterval:i=1,recurrenceEnd:r}=e;if(!t||!(t in h))continue;let c=h[t],l=r?(0,o.A)(r):a,p=c((0,o.A)(e.date),i);for(;!(0,s.A)(p,l)&&!(0,s.A)(p,a);){let t={...e,id:e.id,date:(0,d.A)(p,"yyyy-MM-dd"),recurrenceParent:e,originalDate:e.date};n.push(t),p=c(p,i)}}return n}(r),p=(0,n.A)(new Date);return l.filter(e=>"true"===t.isArchived?(0,o.A)(e.date)<p:"false"!==t.isArchived||(0,o.A)(e.date)>=p).sort((e,a)=>{let n=new Date("".concat(e.date,"T").concat(e.timeStart)),o=new Date("".concat(a.date,"T").concat(a.timeStart));return t.descOrder?o.getTime()-n.getTime():n.getTime()-o.getTime()})}catch(t){throw console.error("Ошибка при запросе мероприятий:",t),t}},m=async t=>{let e=await fetch("http://127.0.0.1:8000/api/event",{method:"POST",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))},body:JSON.stringify(t)});if(!e.ok)throw Error("Ошибка создания: ".concat(e.status));return await e.json()},u=async(t,e)=>{let a=await fetch("http://127.0.0.1:8000/api/event/".concat(t),{method:"PATCH",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))},body:JSON.stringify(e)});if(!a.ok)throw Error("Ошибка обновления: ".concat(a.status))},g=async t=>{let e=await fetch("http://127.0.0.1:8000/api/event/".concat(t),{method:"DELETE",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!e.ok)throw Error("Ошибка удаления: ".concat(e.status))}},5463:(t,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>I});var n=a(7876),o=a(4232),i=a(8207),r=a(8425),c=a(7578),l=a(7018),s=a(4868),d=a(8284),h=a(4410),p=a(2430),m=a(9862),u=a(8421),g=a(4397),f=a(6557),x=a.n(f);a(2204);var w=a(5490),y=a(8151),j=a(8490),A=a(9596),S=a(8532),C=a(1640),E=a(3316);let T=["rgba(50, 193, 255, 0.7)","rgba(50, 67, 255, 0.7)","rgba(50, 122, 255, 0.7)","rgba(42, 200, 71, 0.7)"],v=t=>{let[e,a]=t.split(":").map(Number);return 60*e+a},I=()=>{let t=(0,i.A)("(max-width:1440px)"),e=(0,i.A)("(max-width:810px)"),a=(0,i.A)("(max-width:600px)"),f=t?2:1,I=Array.from({length:Math.ceil(17/f)},(t,e)=>"".concat(String(e*f+6).padStart(2,"0"),":00")),[b,k]=(0,o.useState)([]),[_,D]=(0,o.useState)([]),[N,O]=(0,o.useState)([]),[P,M]=(0,o.useState)(null),[B,L]=(0,o.useState)(x()()),F=(0,o.useRef)(null),[G,R]=(0,o.useState)(!1),[X,z]=(0,o.useState)(!0),[$,H]=(0,o.useState)(null),[J,U]=(0,o.useState)(!1),[Z,q]=(0,o.useState)(null),{showNotification:W}=(0,E.h)(),K=t=>{L(e=>e.add(t,"day"))};(0,o.useEffect)(()=>{(async()=>{try{z(!0),H(null);let t=await (0,A.C)();if(D(t),t.length>0){let e=localStorage.getItem("default_office_id");e?M(Number(e)):M(t[0].id)}}catch(t){W("Не удалось загрузить офисы","error"),H("Не удалось загрузить офисы")}finally{z(!1)}})()},[]),(0,o.useEffect)(()=>{(async()=>{if(P)try{U(!0),q(null);let t=await (0,S.g)({officeId:P});k(t.data);let e=B.toISOString().split("T")[0],a=await (0,C.y$)({officeId:P,date:e});O(a)}catch(t){W("Не удалось загрузить комнаты или мероприятия","error"),q("Не удалось загрузить комнаты или мероприятия")}finally{U(!1)}})()},[P,B]);let Q=t=>{M(t)};return(0,n.jsx)(r.A,{theme:j.A,children:(0,n.jsxs)("div",{children:[(0,n.jsxs)(c.A,{sx:{position:"sticky",top:0,zIndex:10},children:[(0,n.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",marginBottom:"1em",alignItems:a?"flex-end":"start",flexDirection:a?"column":"row",gap:1},children:[(0,n.jsx)(l.A,{variant:"h5",sx:{padding:"12px 0"},children:"Таймлайн"}),(0,n.jsx)(c.A,{sx:{display:"flex",gap:1,flexWrap:"wrap",justifyContent:"flex-end"},children:X?(0,n.jsx)(l.A,{children:"Загрузка офисов..."}):$?(0,n.jsx)(l.A,{color:"error",children:$}):_.map(t=>(0,n.jsx)(s.A,{variant:t.id===P?"contained":"outlined",color:t.id===P?"primary":"secondary",onClick:()=>Q(t.id),children:t.name},t.id))})]}),(0,n.jsx)(u.$,{dateAdapter:g.R,adapterLocale:"ru",children:(0,n.jsxs)(c.A,{sx:{width:"100%",display:"flex",justifyContent:"center",alignItems:"center",marginBottom:"1em",border:"1px solid #A3A3A3",boxSizing:"border-box"},children:[(0,n.jsx)(s.A,{color:"secondary",onClick:()=>K(-1),children:(0,n.jsx)(w.A,{})}),(0,n.jsx)(m.l,{value:B,onChange:t=>{t&&L(t)},slots:{textField:d.A},slotProps:{textField:{inputRef:F,variant:"outlined",sx:{"& .MuiOutlinedInput-notchedOutline":{border:"none"},"& .MuiInputBase-input":{textAlign:"center"}}}}}),(0,n.jsx)(s.A,{color:"secondary",onClick:()=>K(1),children:(0,n.jsx)(y.A,{})})]})})]}),(0,n.jsx)(c.A,{sx:{overflowX:e?"auto":"hidden",width:"100%"},children:(0,n.jsxs)(c.A,{sx:{width:e?"".concat(120*I.length+200,"px"):"100%"},children:[(0,n.jsxs)(h.Ay,{container:!0,spacing:0,sx:{display:"flex",alignItems:"center",background:"#E3E3E3",width:"100%",height:40,marginBottom:"0.5em"},children:[(0,n.jsx)(h.Ay,{item:!0,xs:1.5}),I.map(t=>(0,n.jsx)(h.Ay,{item:!0,xs:!0,children:(0,n.jsx)(l.A,{color:"#858585",children:t})},t))]}),J?(0,n.jsx)(l.A,{children:"Загрузка данных..."}):Z?(0,n.jsx)(l.A,{color:"error",children:Z}):b.map((t,e)=>(0,n.jsxs)(h.Ay,{container:!0,spacing:0,alignItems:"center",sx:{width:"100%","&:nth-of-type(even)":{backgroundColor:"#F4F4F4"},borderBottom:"1px solid #CCCCCC"},children:[(0,n.jsx)(h.Ay,{item:!0,xs:1.5,children:(0,n.jsx)(l.A,{fontSize:"15px",padding:"0 10px",children:t.name})}),I.map(a=>(0,n.jsx)(h.Ay,{item:!0,xs:!0,sx:{display:"grid",alignItems:"center",borderLeft:"1px solid #CCCCCC",height:50,position:"relative"},children:N.filter((e,a)=>e.meetingRoomId===t.id).map((t,o)=>{let i=e%T.length,r=v(t.timeStart),l=v(t.timeEnd),s=v(a);if(l<=s||r>=s+60*f)return null;let d=Math.max(0,r-s)/(60*f)*100,h=Math.min(60*f,l-s)/(60*f)*100;return(0,n.jsx)(p.A,{title:"".concat(t.timeStart," - ").concat(t.timeEnd," ").concat(t.name),arrow:!0,enterTouchDelay:0,leaveTouchDelay:3e3,children:(0,n.jsx)(c.A,{sx:{position:"absolute",top:"5",left:"".concat(d,"%"),width:"".concat(h-d,"%"),height:"50%",backgroundColor:T[i],transition:"height 0.3s ease-in-out"}},o)},o)})},a))]},e))]})})]})})}},8532:(t,e,a)=>{"use strict";a.d(e,{H:()=>o,g:()=>n});let n=async function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let e=new URLSearchParams;t.officeId&&e.append("office_id",t.officeId.toString()),t.name&&e.append("name",t.name),void 0!==t.isActive&&e.append("is_active",t.isActive.toString()),void 0!==t.canAccess&&e.append("can_access",t.canAccess.toString()),t.page&&e.append("page",t.page.toString()),t.limit&&e.append("limit",t.limit.toString());let a="http://127.0.0.1:8000/api/meeting-room?".concat(e.toString());console.log("Запрос:",a);let n=await fetch(a,{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!n.ok){let t=await n.text();throw Error("Ошибка: ".concat(n.status," - ").concat(t))}return await n.json()}catch(t){throw console.error("Ошибка при запросе комнат:",t),t}},o=async t=>{try{let e=await fetch("http://127.0.0.1:8000/api/meeting-room/".concat(t),{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!e.ok){let t=await e.text();throw Error("Ошибка: ".concat(e.status," - ").concat(t))}return await e.json()}catch(t){throw console.error("Ошибка при запросе комнат:",t),t}}},9596:(t,e,a)=>{"use strict";a.d(e,{C:()=>n});let n=async()=>{try{let t=await fetch("http://127.0.0.1:8000/api/office",{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!t.ok)throw Error("Ошибка: ".concat(t.status));return await t.json()}catch(t){throw console.error("Ошибка при запросе офисов:",t),t}}}},t=>{var e=e=>t(t.s=e);t.O(0,[284,487,316,17,144,943,636,593,792],()=>e(505)),_N_E=t.O()}]);