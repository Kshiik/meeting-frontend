(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[63],{3649:(e,t,a)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/profile",function(){return a(9531)}])},4008:(e,t,a)=>{"use strict";a.d(t,{S:()=>i,Y:()=>l});let i=async()=>{let e=await fetch("http://127.0.0.1:8000/api/employee",{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!e.ok)throw Error("Ошибка: ".concat(e.status));return e.json()},l=async(e,t)=>{let a=localStorage.getItem("jwt");if(!(await fetch("http://127.0.0.1:8000/api/employee/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json",jwt:"".concat(a)},body:JSON.stringify(t)})).ok)throw Error("Ошибка обновления данных")}},9531:(e,t,a)=>{"use strict";a.r(t),a.d(t,{default:()=>A});var i=a(7876),l=a(4232),n=a(8207),s=a(8425),o=a(7578),r=a(7018),c=a(4868),d=a(8284),h=a(6120),m=a(656),u=a(5656),p=a(2033),x=a(8490),f=a(9596),g=a(8539),w=a(4008),y=a(9099),j=a(3316),C=a(270);let A=()=>{var e;(0,n.A)("(max-width:1440px)");let t=(0,n.A)("(max-width:1024px)"),a=(0,n.A)("(max-width:600px)"),A=(0,y.useRouter)(),[b,v]=(0,l.useState)({firstName:"",lastName:"",patronymic:"",email:"",password:"",officeId:null,emailNotifications:!0,webPush:!!localStorage.getItem("pushEnabled")&&!!localStorage.getItem("pushEnabled")}),[N,E]=(0,l.useState)([]),[S,_]=(0,l.useState)(null),{user:k,loading:I,updateUser:P,hasRole:V}=(0,g.A)(),{showNotification:W}=(0,j.h)(),[B,M]=(0,l.useState)(!1),[R,T]=(0,l.useState)(!1),[O,H]=(0,l.useState)(!1),[D,L]=(0,l.useState)(null),Z=e=>{let{name:t,value:a}=e.target;v(e=>({...e,[t]:a})),T(!0)},G=async e=>{let{name:t,checked:a}=e.target;if(v(e=>({...e,[t]:a})),localStorage.setItem("pushEnabled",JSON.stringify(e.target.checked)),e.target.checked)try{let e=await (0,C.Lz)(),t=await (0,C.sO)(e,"BBceryB_Lo_6FOu8_jstUK5ExGze1esePCV8P8NwRbSCkOMeIm9xn23_7dTWM14M6YQx2VPEVX8yqcqtgezRppc");await (0,C.eG)(t,k.id)}catch(e){console.error("Push subscription failed:",e)}else{let e=await navigator.serviceWorker.ready,t=await e.pushManager.getSubscription();t&&(await t.unsubscribe(),await (0,C.dJ)(t))}},z=async()=>{if(k){H(!0),L(null);try{let e={name:b.firstName||null,surname:b.lastName||null,patronymic:b.patronymic||null,email:b.email||null,password:B&&b.password?b.password:null};await (0,w.Y)(k.id,e),P({name:b.firstName,surname:b.lastName,patronymic:b.patronymic,email:b.email}),T(!1),M(!1)}catch(e){W("Не удалось сохранить изменения","error"),L("Не удалось сохранить изменения")}finally{H(!1)}}};return(0,l.useEffect)(()=>{(async()=>{try{let e=await (0,f.C)();E(e);let t=localStorage.getItem("default_office_id");_(t?Number(t):null)}catch(e){W("Не удалось загрузить офисы","error")}})()},[]),(0,l.useEffect)(()=>{k&&v({firstName:k.name||"",lastName:k.surname||"",patronymic:k.patronymic||"",email:k.email||"",password:"",officeId:S,emailNotifications:!0,webPush:!0})},[k,S]),(0,i.jsx)(s.A,{theme:x.A,children:(0,i.jsxs)("div",{style:{width:"100%"},children:[(0,i.jsxs)(o.A,{sx:{display:"flex",justifyContent:"space-between",marginBottom:"1em",alignItems:a?"flex-end":"center",flexDirection:a?"column":"row",gap:1},children:[(0,i.jsx)(r.A,{variant:"h5",sx:{padding:"12px 0"},children:"Профиль"}),(0,i.jsx)(o.A,{sx:{display:"flex",gap:2},children:!I&&V("ROLE_USER")&&(0,i.jsx)(c.A,{sx:{color:"secondary.main",background:"#EEEEEE"},onClick:()=>A.push("/archive"),children:"Архив мероприятий"})})]}),(0,i.jsxs)(o.A,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:a?"79vh":"83vh"},children:[(0,i.jsxs)(o.A,{children:[(0,i.jsx)(o.A,{sx:{borderBottom:"1px solid #A3A3A3",marginBottom:"20px"},children:I?(0,i.jsx)(r.A,{variant:"h5",children:"Загрузка..."}):(0,i.jsxs)(o.A,{sx:{width:t?"100%":"620px",display:"flex",gap:"20px",marginBottom:"20px",flexDirection:a?"column":"row"},children:[(0,i.jsxs)(o.A,{sx:{width:a?"100%":"50%",display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsx)(d.A,{label:"Имя",name:"firstName",fullWidth:!0,value:b.firstName,onChange:Z}),(0,i.jsx)(d.A,{label:"Фамилия",name:"lastName",fullWidth:!0,value:b.lastName,onChange:Z}),(0,i.jsx)(d.A,{label:"Отчество",name:"patronymic",fullWidth:!0,value:b.patronymic,onChange:Z})]}),(0,i.jsxs)(o.A,{sx:{width:a?"100%":"50%",display:"flex",flexDirection:"column",gap:2},children:[(0,i.jsx)(d.A,{label:"Email",name:"email",fullWidth:!0,value:b.email,onChange:Z}),B?(0,i.jsx)(d.A,{label:"Новый пароль",name:"password",fullWidth:!0,value:b.password,onChange:Z}):(0,i.jsxs)(c.A,{variant:"outlined",color:"secondary",fullWidth:!0,onClick:()=>M(!0),children:[(0,i.jsx)("img",{src:"/images/edit-icon.svg",alt:"icon",style:{marginRight:5}}),"Изменить пароль"]})]})]})}),(0,i.jsxs)(o.A,{sx:{width:t?"100%":"620px",display:"flex",flexDirection:"column"},children:[(0,i.jsx)(r.A,{variant:"subtitle1",gutterBottom:!0,children:"Офис по умолчанию"}),(0,i.jsxs)(h.A,{name:"office",fullWidth:!0,sx:{width:t?a?"100%":"calc(50% - 10px)":"300px",marginRight:"20px"},value:null!==(e=b.officeId)&&void 0!==e?e:"none",onChange:e=>{let t="none"===e.target.value?null:Number(e.target.value);v(e=>({...e,officeId:t})),_(t),null===t?localStorage.removeItem("default_office_id"):localStorage.setItem("default_office_id",t.toString())},children:[(0,i.jsx)(m.A,{value:"none",children:"Нет офиса по умолчанию"}),N.map(e=>(0,i.jsx)(m.A,{value:e.id,children:e.name},e.id))]}),(0,i.jsx)(u.A,{control:(0,i.jsx)(p.A,{checked:b.webPush,onChange:G,name:"webPush"}),label:"Web-пуши о мероприятиях"})]})]}),(0,i.jsxs)(o.A,{sx:{display:"flex",gap:2,justifyContent:"flex-end"},children:[(0,i.jsxs)(c.A,{variant:"outlined",color:"secondary",onClick:()=>{k&&(v({firstName:k.name||"",lastName:k.surname||"",patronymic:k.patronymic||"",email:k.email||"",password:"",officeId:S,emailNotifications:!0,webPush:!0}),T(!1),M(!1))},disabled:O,sx:{width:a?"100%":"auto"},children:[(0,i.jsx)("img",{width:"18",height:"18",src:"/images/cancel-icon.svg",alt:"icon",style:{marginRight:10}}),"Отменить"]}),(0,i.jsxs)(c.A,{variant:R?"contained":"outlined",color:R?"primary":"secondary",onClick:z,disabled:O||!R,sx:{width:a?"100%":"auto"},children:[(0,i.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 19 19",fill:"currentColor",style:{marginRight:10},children:(0,i.jsx)("path",{d:"M18 4.5V16.5C18 17.05 17.8042 17.5208 17.4125 17.9125C17.0208 18.3042 16.55 18.5 16 18.5H2C1.45 18.5 0.979167 18.3042 0.5875 17.9125C0.195833 17.5208 0 17.05 0 16.5V2.5C0 1.95 0.195833 1.47917 0.5875 1.0875C0.979167 0.695833 1.45 0.5 2 0.5H14L18 4.5ZM16 5.35L13.15 2.5H2V16.5H16V5.35ZM9 15.5C9.83333 15.5 10.5417 15.2083 11.125 14.625C11.7083 14.0417 12 13.3333 12 12.5C12 11.6667 11.7083 10.9583 11.125 10.375C10.5417 9.79167 9.83333 9.5 9 9.5C8.16667 9.5 7.45833 9.79167 6.875 10.375C6.29167 10.9583 6 11.6667 6 12.5C6 13.3333 6.29167 14.0417 6.875 14.625C7.45833 15.2083 8.16667 15.5 9 15.5ZM3 7.5H12V4.5H3V7.5ZM2 5.35V16.5V2.5V5.35Z"})}),O?"Сохранение...":"Сохранить"]})]})]})]})})}},9596:(e,t,a)=>{"use strict";a.d(t,{C:()=>i});let i=async()=>{try{let e=await fetch("http://127.0.0.1:8000/api/office",{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!e.ok)throw Error("Ошибка: ".concat(e.status));return await e.json()}catch(e){throw console.error("Ошибка при запросе офисов:",e),e}}}},e=>{var t=t=>e(e.s=t);e.O(0,[284,487,33,978,636,593,792],()=>t(3649)),_N_E=e.O()}]);