(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[754],{1640:(e,t,n)=>{"use strict";n.d(t,{lh:()=>p,SX:()=>m,y$:()=>x,qM:()=>u});var a=n(3266),o=n(4493),i=n(3495),r=n(6559),c=n(183),s=n(9748),l=n(6373),d=n(2572);let h={day:i.A,week:r.A,month:c.A,year:s.A},x=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=new URLSearchParams;e.roomId&&t.append("room_id",e.roomId.toString()),e.name&&t.append("name",e.name),e.type&&t.append("type",e.type),e.date&&t.append("date",e.date),e.officeId&&t.append("office_id",e.officeId.toString());let n="http://127.0.0.1:8000/api/event?".concat(t.toString());console.log("Запрос:",n);let i=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!i.ok){let e=await i.text();throw Error("Ошибка: ".concat(i.status," - ").concat(e))}let r=(await i.json()).data.map(e=>{let t=new Date("".concat(e.date,"T").concat(e.timeStart,"Z")),n=new Date("".concat(e.date,"T").concat(e.timeEnd,"Z")),a=e=>e.toLocaleTimeString("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit"}).replace(/,/g,"");return{...e,timeStart:a(t),timeEnd:a(n)}}),s=function(e){let t=new Date,n=(0,c.A)(t,24),a=[];for(let t of e){if(t.recurrenceParent)continue;a.push(t);let{recurrenceTypeValue:e,recurrenceInterval:i=1,recurrenceEnd:r}=t;if(!e||!(e in h))continue;let c=h[e],s=r?(0,o.A)(r):n,x=c((0,o.A)(t.date),i);for(;!(0,l.A)(x,s)&&!(0,l.A)(x,n);){let e={...t,id:t.id,date:(0,d.A)(x,"yyyy-MM-dd"),recurrenceParent:t,originalDate:t.date};a.push(e),x=c(x,i)}}return a}(r),x=(0,a.A)(new Date);return s.filter(t=>"true"===e.isArchived?(0,o.A)(t.date)<x:"false"!==e.isArchived||(0,o.A)(t.date)>=x).sort((t,n)=>{let a=new Date("".concat(t.date,"T").concat(t.timeStart)),o=new Date("".concat(n.date,"T").concat(n.timeStart));return e.descOrder?o.getTime()-a.getTime():a.getTime()-o.getTime()})}catch(e){throw console.error("Ошибка при запросе мероприятий:",e),e}},p=async e=>{let t=await fetch("http://127.0.0.1:8000/api/event",{method:"POST",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))},body:JSON.stringify(e)});if(!t.ok)throw Error("Ошибка создания: ".concat(t.status));return await t.json()},u=async(e,t)=>{let n=await fetch("http://127.0.0.1:8000/api/event/".concat(e),{method:"PATCH",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))},body:JSON.stringify(t)});if(!n.ok)throw Error("Ошибка обновления: ".concat(n.status))},m=async e=>{let t=await fetch("http://127.0.0.1:8000/api/event/".concat(e),{method:"DELETE",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!t.ok)throw Error("Ошибка удаления: ".concat(t.status))}},2958:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>N});var a=n(7876),o=n(4232),i=n(8207),r=n(8425),c=n(7578),s=n(7018),l=n(4868),d=n(8284),h=n(6120),x=n(656),p=n(1778),u=n(4348),m=n(1951),w=n(7339),j=n(2639),A=n(8107),g=n(755),f=n(6347),y=n(946),v=n(9444),C=n(7224),S=n(968),E=n(4203),b=n(4274),k=n(8490),T=n(9099),F=n(1640),I=n(8532),_=n(4113),D=n(3316);let N=()=>{let e=(0,i.A)("(max-width:1440px)"),t=(0,i.A)("(max-width:1560px)"),n=(0,i.A)("(max-width:1024px)"),N=(0,i.A)("(max-width:600px)"),O=(0,T.useRouter)(),{confirm:P,ConfirmComponent:Z}=(0,_.G)(),{showNotification:B}=(0,D.h)(),[M,G]=(0,o.useState)(0),[H,L]=(0,o.useState)("Я организатор"),[W,R]=(0,o.useState)([]),[X,z]=(0,o.useState)([]),[J,U]=(0,o.useState)(0),[$,q]=(0,o.useState)(!0),[V,K]=(0,o.useState)(null),[Q,Y]=(0,o.useState)(""),[ee,et]=(0,o.useState)(""),[en,ea]=(0,o.useState)(!1),[eo,ei]=(0,o.useState)(1),[er]=(0,o.useState)(10),[ec,es]=(0,o.useState)(1),[el,ed]=(0,o.useState)({}),[eh,ex]=(0,o.useState)({}),ep={day:"день",week:"неделю",month:"месяц",year:"год"},eu=e=>{ed(t=>({...t,[e]:!t[e]}))},em=e=>t=>{ex(n=>({...n,[e]:t.currentTarget}))},ew=e=>()=>{ex(t=>({...t,[e]:null}))},ej=(e,t)=>{G(e),L(t)},eA=async e=>{if(await P({message:"Вы уверены, что хотите удалить это мероприятие?",confirmText:"Удалить",cancelText:"Отмена"}))try{await (0,F.SX)(e.id),ex({}),eg(),B("Мероприятие успешно удалено","success")}catch(e){console.error("Ошибка при удалении:",e),B("Не удалось удалить мероприятие","error")}};(0,o.useEffect)(()=>{(async()=>{try{let e=await (0,I.g)();R(e.data)}catch(e){B("Не удалось загрузить комнаты","error")}})()},[]);let eg=async()=>{try{q(!0),K(null);let e=await (0,F.y$)({roomId:""===ee?void 0:ee,name:Q||void 0,type:0===M?"организатор":"участник",isArchived:"true",descOrder:en,page:eo,limit:er});z(e),U(e.length),es(5)}catch(e){B("Не удалось загрузить мероприятия","error"),K("Не удалось загрузить мероприятия")}finally{q(!1)}};return(0,o.useEffect)(()=>{eg()},[M,Q,ee,en,eo,er]),(0,a.jsxs)(r.A,{theme:k.A,children:[(0,a.jsxs)("div",{style:{width:"100%",display:"flex",flexDirection:"column",justifyContent:"space-between",height:n?"94vh":"92vh"},children:[(0,a.jsxs)(c.A,{children:[(0,a.jsx)(c.A,{sx:{marginBottom:"1em"},children:t?(0,a.jsxs)(c.A,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",gap:2},children:[(0,a.jsxs)(c.A,{sx:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:N?"flex-end":"center",flexDirection:N?"column":"row",gap:1},children:[(0,a.jsxs)(c.A,{sx:{display:"flex",gap:1},children:[(0,a.jsx)(s.A,{variant:"h5",sx:{padding:"12px 0",marginLeft:N?"50px":"0px",textAlign:"end"},children:"Архив мероприятий"}),(0,a.jsx)(s.A,{sx:{color:"#A3A3A3"},children:$?0:V?0:J})]}),(0,a.jsx)(l.A,{onClick:()=>O.push("/profile"),sx:{color:"secondary.main",background:"#EEEEEE",whiteSpace:"nowrap"},children:"В профиль"})]}),(0,a.jsxs)(c.A,{sx:{display:"flex",gap:2,width:"100%",flexDirection:N?"column":"row"},children:[(0,a.jsx)(d.A,{variant:"outlined",placeholder:"Название мероприятия",value:Q,onChange:e=>Y(e.target.value),sx:{width:t?"100%":"230px"}}),(0,a.jsxs)(h.A,{value:ee,onChange:e=>et(e.target.value),displayEmpty:!0,sx:{width:t?"100%":"230px"},children:[(0,a.jsx)(x.A,{value:"",children:"Все комнаты"}),W.map(e=>(0,a.jsx)(x.A,{value:e.id,children:e.name},e.id))]}),(0,a.jsxs)(p.A,{direction:"row",children:[(0,a.jsx)(l.A,{variant:"Я организатор"===H?"contained":"outlined",color:"Я организатор"===H?"success":"secondary",onClick:()=>ej(0,"Я организатор"),sx:{flex:e?1:"auto",width:e?"100%":"auto",border:"1px solid",borderColor:"Я организатор"===H?"success.main":"secondary.main",boxShadow:"Я организатор"===H?"none":void 0,"&:hover":{boxShadow:"none"},whiteSpace:"nowrap"},children:"Я организатор"}),(0,a.jsx)(l.A,{variant:"Я участник"===H?"contained":"outlined",color:"Я участник"===H?"success":"secondary",onClick:()=>ej(1,"Я участник"),sx:{flex:e?1:"auto",width:e?"100%":"auto",border:"1px solid",borderColor:"Я участник"===H?"success.main":"secondary.main",boxShadow:"Я участник"===H?"none":void 0,"&:hover":{boxShadow:"none"},whiteSpace:"nowrap"},children:"Я участник"})]})]})]}):(0,a.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between"},children:[(0,a.jsxs)(c.A,{sx:{display:"flex",gap:1},children:[(0,a.jsx)(s.A,{variant:"h5",sx:{whiteSpace:"nowrap",padding:"12px 0"},children:"Архив мероприятий"}),(0,a.jsx)(s.A,{sx:{color:"#A3A3A3"},children:$?0:V?0:J})]}),(0,a.jsxs)(c.A,{sx:{display:"flex",gap:2},children:[(0,a.jsxs)(c.A,{sx:{display:"flex",alignItems:"center",gap:2},children:[(0,a.jsxs)(p.A,{direction:"row",children:[(0,a.jsx)(l.A,{variant:"Я организатор"===H?"contained":"outlined",color:"Я организатор"===H?"success":"secondary",onClick:()=>ej(0,"Я организатор"),sx:{flex:e?1:"auto",width:e?"100%":"auto",border:"1px solid",borderColor:"Я организатор"===H?"success.main":"secondary.main",boxShadow:"Я организатор"===H?"none":void 0,"&:hover":{boxShadow:"none"},whiteSpace:"nowrap"},children:"Я организатор"}),(0,a.jsx)(l.A,{variant:"Я участник"===H?"contained":"outlined",color:"Я участник"===H?"success":"secondary",onClick:()=>ej(1,"Я участник"),sx:{flex:e?1:"auto",width:e?"100%":"auto",border:"1px solid",borderColor:"Я участник"===H?"success.main":"secondary.main",boxShadow:"Я участник"===H?"none":void 0,"&:hover":{boxShadow:"none"},whiteSpace:"nowrap"},children:"Я участник"})]}),(0,a.jsx)(d.A,{variant:"outlined",placeholder:"Название мероприятия",value:Q,onChange:e=>Y(e.target.value),sx:{width:"270px"}}),(0,a.jsxs)(h.A,{value:ee,onChange:e=>et(e.target.value),displayEmpty:!0,sx:{width:"270px"},children:[(0,a.jsx)(x.A,{value:"",children:"Все комнаты"}),W.map(e=>(0,a.jsx)(x.A,{value:e.id,children:e.name},e.id))]})]}),(0,a.jsx)(l.A,{onClick:()=>O.push("/profile"),sx:{color:"secondary.main",background:"#EEEEEE",whiteSpace:"nowrap"},children:"В профиль"})]})]})}),(0,a.jsx)(c.A,{children:(0,a.jsx)(u.A,{component:m.A,children:(0,a.jsxs)(w.A,{children:[(0,a.jsx)(j.A,{color:"secondary",children:(0,a.jsxs)(A.A,{children:[(0,a.jsx)(g.A,{}),(0,a.jsx)(g.A,{children:"Наименование"}),(0,a.jsx)(g.A,{sx:{whiteSpace:"nowrap"},children:e?"Перег. комната":"Переговорная комната"}),(0,a.jsx)(g.A,{children:"Дата"}),(0,a.jsx)(g.A,{children:e?"Начало":"Время начала"}),(0,a.jsx)(g.A,{children:e?"Конец":"Время оканчания"}),(0,a.jsx)(g.A,{children:"Повторы"}),(0,a.jsx)(g.A,{align:"center",children:(0,a.jsx)("svg",{width:"16",height:"10",viewBox:"0 0 16 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,a.jsx)("path",{d:"M2 4C1.45 4 0.979167 3.80417 0.5875 3.4125C0.195833 3.02083 0 2.55 0 2C0 1.45 0.195833 0.979167 0.5875 0.5875C0.979167 0.195833 1.45 0 2 0C2.55 0 3.02083 0.195833 3.4125 0.5875C3.80417 0.979167 4 1.45 4 2C4 2.55 3.80417 3.02083 3.4125 3.4125C3.02083 3.80417 2.55 4 2 4ZM8 4C7.45 4 6.97917 3.80417 6.5875 3.4125C6.19583 3.02083 6 2.55 6 2C6 1.45 6.19583 0.979167 6.5875 0.5875C6.97917 0.195833 7.45 0 8 0C8.55 0 9.02083 0.195833 9.4125 0.5875C9.80417 0.979167 10 1.45 10 2C10 2.55 9.80417 3.02083 9.4125 3.4125C9.02083 3.80417 8.55 4 8 4ZM14 4C13.45 4 12.9792 3.80417 12.5875 3.4125C12.1958 3.02083 12 2.55 12 2C12 1.45 12.1958 0.979167 12.5875 0.5875C12.9792 0.195833 13.45 0 14 0C14.55 0 15.0208 0.195833 15.4125 0.5875C15.8042 0.979167 16 1.45 16 2C16 2.55 15.8042 3.02083 15.4125 3.4125C15.0208 3.80417 14.55 4 14 4Z",fill:"#858585"})})})]})}),(0,a.jsx)(f.A,{children:$?(0,a.jsx)(A.A,{children:(0,a.jsx)(g.A,{colSpan:7,children:(0,a.jsx)(s.A,{align:"center",children:"Загрузка..."})})}):V?(0,a.jsx)(A.A,{children:(0,a.jsx)(g.A,{colSpan:7,children:(0,a.jsx)(s.A,{align:"center",color:"error",children:V})})}):X.map((e,t)=>(0,a.jsxs)(o.Fragment,{children:[(0,a.jsxs)(A.A,{sx:{"&:nth-of-type(odd)":{backgroundColor:"#FFFFFF"},"&:nth-of-type(4n-3)":{backgroundColor:"#F4F4F4"}},children:[(0,a.jsx)(g.A,{children:(0,a.jsx)(y.A,{onClick:()=>eu(t),size:"small",sx:{padding:"0"},children:el[t]?(0,a.jsx)(E.A,{}):(0,a.jsx)(b.A,{})})}),(0,a.jsx)(g.A,{sx:{maxWidth:n?"165px":"300px",overflow:el[t]?"visible":"hidden",textOverflow:el[t]?"unset":"ellipsis",whiteSpace:el[t]?"normal":"nowrap"},children:e.name}),(0,a.jsx)(g.A,{sx:{maxWidth:"165px",overflow:el[t]?"visible":"hidden",textOverflow:el[t]?"unset":"ellipsis",whiteSpace:el[t]?"normal":"nowrap"},children:e.meetingRoomName}),(0,a.jsx)(g.A,{sx:{whiteSpace:"nowrap"},children:e.date}),(0,a.jsx)(g.A,{children:e.timeStart}),(0,a.jsx)(g.A,{children:e.timeEnd}),(0,a.jsx)(g.A,{sx:{whiteSpace:"nowrap"},children:e.recurrenceInterval?"Каждый(ую) ".concat(e.recurrenceInterval," ").concat(ep[e.recurrenceTypeValue],", до ").concat(e.recurrenceEnd):"Нет повторов"}),(0,a.jsxs)(g.A,{align:"center",children:[(0,a.jsx)(y.A,{onClick:em(t),sx:{padding:"0"},children:(0,a.jsx)("svg",{height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#858585",children:(0,a.jsx)("path",{d:"M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"})})}),(0,a.jsx)(v.A,{anchorEl:eh[t],open:!!eh[t],onClose:ew(t),sx:{border:"1px solid #858585"},children:(0,a.jsxs)(x.A,{onClick:()=>eA(e),sx:{gap:1},children:[(0,a.jsx)("svg",{height:"20px",viewBox:"0 -960 960 960",width:"20px",children:(0,a.jsx)("path",{d:"m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"})})," Удалить мероприятие"]})})]})]}),(0,a.jsxs)(A.A,{children:[(0,a.jsx)(g.A,{sx:{padding:0}}),(0,a.jsx)(g.A,{colSpan:7,sx:{padding:0},children:(0,a.jsx)(C.A,{in:el[t],timeout:"auto",unmountOnExit:!0,children:(0,a.jsxs)(c.A,{sx:{margin:2},children:[(0,a.jsxs)(c.A,{sx:{paddingBottom:1},children:[(0,a.jsx)(s.A,{color:"#858585",sx:{backgroundColor:"#E3E3E3",padding:1},children:"Описание"}),(0,a.jsx)(s.A,{sx:{backgroundColor:"#F4F4F4",padding:1},children:e.description})]}),(0,a.jsxs)(c.A,{sx:{paddingBottom:1},children:[(0,a.jsx)(s.A,{color:"#858585",sx:{backgroundColor:"#E3E3E3",padding:1},children:"Участники"}),e.employees.length>0?e.employees.map(e=>(0,a.jsx)(s.A,{sx:{backgroundColor:"#F4F4F4",padding:1},children:e.fullName},e.id)):(0,a.jsx)(s.A,{sx:{backgroundColor:"#F4F4F4",padding:1},children:"Не указано"})]})]})})})]})]},t))})]})})})]}),ec>1&&(0,a.jsx)(c.A,{sx:{mt:4,display:"flex",justifyContent:"start"},children:(0,a.jsx)(S.A,{count:ec,page:eo,onChange:(e,t)=>{ei(t)},color:"primary",size:"medium"})})]}),(0,a.jsx)(Z,{})]})}},4113:(e,t,n)=>{"use strict";n.d(t,{G:()=>x});var a=n(7876),o=n(4232),i=n(5596),r=n(7866),c=n(3034),s=n(7018),l=n(8523),d=n(4868);let h=e=>{let{open:t,onClose:n,title:o="Подтверждение",message:h="Вы уверены?",confirmText:x="Да",cancelText:p="Нет"}=e;return(0,a.jsxs)(i.A,{open:t,onClose:()=>n(!1),maxWidth:"sm",fullWidth:!0,children:[(0,a.jsx)(r.A,{children:o}),(0,a.jsx)(c.A,{children:(0,a.jsx)(s.A,{children:h})}),(0,a.jsxs)(l.A,{children:[(0,a.jsx)(d.A,{onClick:()=>n(!1),color:"primary",children:p}),(0,a.jsx)(d.A,{onClick:()=>n(!0),color:"primary",variant:"contained",children:x})]})]})},x=()=>{let[e,t]=(0,o.useState)(!1),[n,i]=(0,o.useState)({}),[r,c]=(0,o.useState)(null),s=e=>{t(!1),r&&(r(e),c(null))};return{confirm:function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return i(e),t(!0),new Promise(e=>{c(()=>e)})},ConfirmComponent:()=>(0,a.jsx)(h,{open:e,onClose:s,title:n.title||"Подтверждение",message:n.message||"Вы уверены?",confirmText:n.confirmText||"Да",cancelText:n.cancelText||"Нет"})}}},8532:(e,t,n)=>{"use strict";n.d(t,{H:()=>o,g:()=>a});let a=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};try{let t=new URLSearchParams;e.officeId&&t.append("office_id",e.officeId.toString()),e.name&&t.append("name",e.name),void 0!==e.isActive&&t.append("is_active",e.isActive.toString()),void 0!==e.canAccess&&t.append("can_access",e.canAccess.toString()),e.page&&t.append("page",e.page.toString()),e.limit&&t.append("limit",e.limit.toString());let n="http://127.0.0.1:8000/api/meeting-room?".concat(t.toString());console.log("Запрос:",n);let a=await fetch(n,{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!a.ok){let e=await a.text();throw Error("Ошибка: ".concat(a.status," - ").concat(e))}return await a.json()}catch(e){throw console.error("Ошибка при запросе комнат:",e),e}},o=async e=>{try{let t=await fetch("http://127.0.0.1:8000/api/meeting-room/".concat(e),{method:"GET",headers:{"Content-Type":"application/json",jwt:"".concat(localStorage.getItem("jwt"))}});if(!t.ok){let e=await t.text();throw Error("Ошибка: ".concat(t.status," - ").concat(e))}return await t.json()}catch(e){throw console.error("Ошибка при запросе комнат:",e),e}}},8857:(e,t,n)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/archive",function(){return n(2958)}])}},e=>{var t=t=>e(e.s=t);e.O(0,[284,487,316,473,883,636,593,792],()=>t(8857)),_N_E=e.O()}]);