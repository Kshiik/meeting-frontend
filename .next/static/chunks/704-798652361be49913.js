"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[704],{1704:(e,n,s)=>{s.r(n),s.d(n,{default:()=>T});var l=s(7876),r=s(4232),i=s(8207),t=s(8425),a=s(7578),c=s(7018),d=s(4868),x=s(8284),o=s(6120),h=s(656),p=s(4348),u=s(1951),j=s(7339),A=s(2639),m=s(8107),g=s(755),v=s(946),w=s(6347),C=s(9444),f=s(7224),y=s(968),S=s(4274),E=s(4203),F=s(8490),k=s(8539),I=s(9099),b=s(8532),Z=s(1640),R=s(7133),M=s(4113),O=s(3316);let T=e=>{var n;let{disableRoomElements:s=!1,idRoom:T,showAuthorColumn:B=!1}=e,D={day:"день",week:"неделю",month:"месяц",year:"год"},H=(0,i.A)("(max-width:1440px)"),_=(0,i.A)("(max-width:1024px)"),z=(0,i.A)("(max-width:600px)"),{user:N,loading:q,hasRole:L}=(0,k.A)(),V=(0,I.useRouter)(),{showNotification:W}=(0,O.h)(),{confirm:G,ConfirmComponent:X}=(0,M.G)();(0,r.useEffect)(()=>{q||N&&L("ROLE_MODERATOR")||V.push("/events")},[N,q,L,V]);let[$,J]=(0,r.useState)([]),[K,P]=(0,r.useState)([]),[Q,U]=(0,r.useState)(0),[Y,ee]=(0,r.useState)(!0),[en,es]=(0,r.useState)(null),[el,er]=(0,r.useState)({}),[ei,et]=(0,r.useState)({}),[ea,ec]=(0,r.useState)(!1),[ed,ex]=(0,r.useState)("create"),[eo,eh]=(0,r.useState)(null),[ep,eu]=(0,r.useState)(""),[ej,eA]=(0,r.useState)(T||""),[em,eg]=(0,r.useState)(!1),[ev,ew]=(0,r.useState)(1),[eC,ef]=(0,r.useState)(1),[ey,eS]=(0,r.useState)([]),eE=e=>{er(n=>({...n,[e]:!n[e]}))},eF=e=>n=>{et(s=>({...s,[e]:n.currentTarget}))},ek=e=>()=>{et(n=>({...n,[e]:null}))},eI=()=>{ex("create"),eh(null),ec(!0)},eb=e=>{ex("edit"),eh(e),ec(!0)},eZ=async e=>{if(await G({message:"Вы уверены, что хотите удалить это мероприятие?",confirmText:"Удалить",cancelText:"Отмена"}))try{await (0,Z.SX)(e.id),et({}),eR(),W("Мероприятие успешно удалено","success")}catch(e){W("Не удалось удалить мероприятие","error")}};(0,r.useEffect)(()=>{(async()=>{try{let e=await (0,b.g)();P(e.data)}catch(e){W("Не удалось загрузить комнаты","error")}})()},[]);let eR=async()=>{try{ee(!0),es(null);let e=await (0,Z.y$)({roomId:""===ej?void 0:ej,name:ep||void 0,descOrder:em});J(e),U(e.length),ef(Math.ceil(e.length/10)),ew(1),eS(e.slice(0,10))}catch(e){W("Не удалось загрузить мероприятия","error")}finally{ee(!1)}};return((0,r.useEffect)(()=>{eR()},[ep,ej,em]),q)?(0,l.jsx)(t.A,{theme:F.A,children:(0,l.jsx)(a.A,{sx:{padding:1},children:(0,l.jsx)(c.A,{children:"Загрузка..."})})}):N&&L("ROLE_MODERATOR")?(0,l.jsx)(t.A,{theme:F.A,children:(0,l.jsxs)("div",{children:[(0,l.jsxs)(a.A,{sx:{display:"flex",alignItems:H?"stetch":"center",justifyContent:"space-between",marginBottom:"1em",flexDirection:H?"column":"row",gap:1},children:[(0,l.jsx)(a.A,{sx:{display:"flex",justifyContent:"space-between",width:"100%",alignItems:z?"flex-end":"center",flexDirection:z?"column":"row",gap:1},children:(0,l.jsxs)(a.A,{sx:{display:"flex",gap:1},children:[(0,l.jsx)(c.A,{variant:"h5",sx:{whiteSpace:"nowrap",padding:"12px 0"},children:"Все мероприятия"}),(0,l.jsx)(c.A,{sx:{color:"#A3A3A3"},children:Y?0:en?0:Q})]})}),(0,l.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",gap:2,flexDirection:z?"column":"row"},children:[(0,l.jsx)(d.A,{variant:"outlined",color:"secondary",onClick:()=>eI(),sx:{width:z?"100%":"auto"},children:(0,l.jsx)("svg",{height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#858585",children:(0,l.jsx)("path",{d:"M440-440H200v-80h240v-240h80v240h240v80H520v240h-80v-240Z"})})}),(0,l.jsxs)(a.A,{sx:{display:"flex",gap:2,width:"100%",flexDirection:z?"column":"row"},children:[(0,l.jsx)(x.A,{variant:"outlined",placeholder:"Название мероприятия",value:ep,onChange:e=>eu(e.target.value),sx:{width:H?"100%":"230px"}}),!s&&(0,l.jsxs)(o.A,{value:ej,onChange:e=>eA(e.target.value),displayEmpty:!0,sx:{width:H?"100%":"230px"},children:[(0,l.jsx)(h.A,{value:"",children:"Все комнаты"}),K.map(e=>(0,l.jsx)(h.A,{value:e.id,children:e.name},e.id))]})]})]})]}),(0,l.jsx)(p.A,{component:u.A,children:(0,l.jsxs)(j.A,{children:[(0,l.jsx)(A.A,{color:"secondary",children:(0,l.jsxs)(m.A,{children:[(0,l.jsx)(g.A,{}),(0,l.jsx)(g.A,{children:"Наименование"}),B&&(0,l.jsx)(g.A,{children:"Автор"}),(0,l.jsx)(g.A,{sx:{whiteSpace:"nowrap"},children:H?"Перег. комната":"Переговорная комната"}),(0,l.jsx)(g.A,{children:(0,l.jsxs)(a.A,{sx:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>eg(!em),children:[(0,l.jsx)(c.A,{variant:"inherit",children:"Дата"}),(0,l.jsx)(v.A,{size:"small",sx:{ml:.5},children:em?(0,l.jsx)(S.A,{fontSize:"small"}):(0,l.jsx)(E.A,{fontSize:"small"})})]})}),(0,l.jsx)(g.A,{children:H?"Начало":"Время начала"}),(0,l.jsx)(g.A,{children:H?"Конец":"Время оканчания"}),(0,l.jsx)(g.A,{children:"Повторы"}),(0,l.jsx)(g.A,{align:"center",children:(0,l.jsx)("svg",{width:"16",height:"10",viewBox:"0 0 16 4",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,l.jsx)("path",{d:"M2 4C1.45 4 0.979167 3.80417 0.5875 3.4125C0.195833 3.02083 0 2.55 0 2C0 1.45 0.195833 0.979167 0.5875 0.5875C0.979167 0.195833 1.45 0 2 0C2.55 0 3.02083 0.195833 3.4125 0.5875C3.80417 0.979167 4 1.45 4 2C4 2.55 3.80417 3.02083 3.4125 3.4125C3.02083 3.80417 2.55 4 2 4ZM8 4C7.45 4 6.97917 3.80417 6.5875 3.4125C6.19583 3.02083 6 2.55 6 2C6 1.45 6.19583 0.979167 6.5875 0.5875C6.97917 0.195833 7.45 0 8 0C8.55 0 9.02083 0.195833 9.4125 0.5875C9.80417 0.979167 10 1.45 10 2C10 2.55 9.80417 3.02083 9.4125 3.4125C9.02083 3.80417 8.55 4 8 4ZM14 4C13.45 4 12.9792 3.80417 12.5875 3.4125C12.1958 3.02083 12 2.55 12 2C12 1.45 12.1958 0.979167 12.5875 0.5875C12.9792 0.195833 13.45 0 14 0C14.55 0 15.0208 0.195833 15.4125 0.5875C15.8042 0.979167 16 1.45 16 2C16 2.55 15.8042 3.02083 15.4125 3.4125C15.0208 3.80417 14.55 4 14 4Z",fill:"#858585"})})})]})}),(0,l.jsx)(w.A,{children:Y?(0,l.jsx)(m.A,{children:(0,l.jsx)(g.A,{colSpan:8,children:(0,l.jsx)(c.A,{align:"center",children:"Загрузка..."})})}):en?(0,l.jsx)(m.A,{children:(0,l.jsx)(g.A,{colSpan:8,children:(0,l.jsx)(c.A,{align:"center",color:"error",children:en})})}):ey.map((e,n)=>(0,l.jsxs)(r.Fragment,{children:[(0,l.jsxs)(m.A,{sx:{"&:nth-of-type(odd)":{backgroundColor:"#FFFFFF"},"&:nth-of-type(4n-3)":{backgroundColor:"#F4F4F4"}},children:[(0,l.jsx)(g.A,{children:(0,l.jsx)(v.A,{onClick:()=>eE(n),size:"small",sx:{padding:"0"},children:el[n]?(0,l.jsx)(E.A,{}):(0,l.jsx)(S.A,{})})}),(0,l.jsx)(g.A,{sx:{maxWidth:_?"165px":"300px",overflow:el[n]?"visible":"hidden",textOverflow:el[n]?"unset":"ellipsis",whiteSpace:el[n]?"normal":"nowrap"},children:e.name}),B&&(0,l.jsx)(g.A,{children:e.author.fullName}),(0,l.jsx)(g.A,{sx:{maxWidth:"165px",overflow:el[n]?"visible":"hidden",textOverflow:el[n]?"unset":"ellipsis",whiteSpace:el[n]?"normal":"nowrap"},children:e.meetingRoomName}),(0,l.jsx)(g.A,{sx:{whiteSpace:"nowrap"},children:e.date}),(0,l.jsx)(g.A,{children:e.timeStart}),(0,l.jsx)(g.A,{children:e.timeEnd}),(0,l.jsx)(g.A,{sx:{whiteSpace:"nowrap"},children:e.recurrenceInterval?"Каждый (ую) ".concat(e.recurrenceInterval," ").concat(D[e.recurrenceTypeValue],", до ").concat(e.recurrenceEnd):"Нет повторов"}),(0,l.jsxs)(g.A,{align:"center",children:[(0,l.jsx)(v.A,{onClick:eF(n),sx:{padding:"0"},children:(0,l.jsx)("svg",{height:"24px",viewBox:"0 -960 960 960",width:"24px",fill:"#858585",children:(0,l.jsx)("path",{d:"M120-240v-80h720v80H120Zm0-200v-80h720v80H120Zm0-200v-80h720v80H120Z"})})}),(0,l.jsxs)(C.A,{anchorEl:ei[n],open:!!ei[n],onClose:ek(n),sx:{border:"1px solid #858585"},children:[(0,l.jsxs)(h.A,{sx:{gap:1},onClick:()=>eb(e),children:[(0,l.jsx)("svg",{height:"20px",viewBox:"0 -960 960 960",width:"20px",children:(0,l.jsx)("path",{d:"M200-200h57l391-391-57-57-391 391v57Zm-80 80v-170l528-527q12-11 26.5-17t30.5-6q16 0 31 6t26 18l55 56q12 11 17.5 26t5.5 30q0 16-5.5 30.5T817-647L290-120H120Zm640-584-56-56 56 56Zm-141 85-28-29 57 57-29-28Z"})}),e.recurrenceInterval?"Изменить серию":"Изменить мероприятие"]}),(0,l.jsxs)(h.A,{sx:{gap:1},onClick:()=>eZ(e),children:[(0,l.jsx)("svg",{height:"20px",viewBox:"0 -960 960 960",width:"20px",children:(0,l.jsx)("path",{d:"m256-200-56-56 224-224-224-224 56-56 224 224 224-224 56 56-224 224 224 224-56 56-224-224-224 224Z"})}),e.recurrenceInterval?"Удалить серию":"Удалить мероприятие"]})]})]})]}),(0,l.jsxs)(m.A,{children:[(0,l.jsx)(g.A,{sx:{padding:0}}),(0,l.jsx)(g.A,{colSpan:7,sx:{padding:0},children:(0,l.jsx)(f.A,{in:el[n],timeout:"auto",unmountOnExit:!0,children:(0,l.jsxs)(a.A,{sx:{margin:2},children:[(0,l.jsxs)(a.A,{sx:{paddingBottom:1},children:[(0,l.jsx)(c.A,{color:"#858585",sx:{backgroundColor:"#E3E3E3",padding:1},children:"Описание"}),(0,l.jsx)(c.A,{sx:{backgroundColor:"#F4F4F4",padding:1},children:e.description})]}),(0,l.jsxs)(a.A,{sx:{paddingBottom:1},children:[(0,l.jsx)(c.A,{color:"#858585",sx:{backgroundColor:"#E3E3E3",padding:1},children:"Участники"}),e.employees.length>0?e.employees.map(e=>(0,l.jsx)(c.A,{sx:{backgroundColor:"#F4F4F4",padding:1},children:e.fullName},e.id)):(0,l.jsx)(c.A,{sx:{backgroundColor:"#F4F4F4",padding:1},children:"Не указано"})]})]})})})]})]},"".concat(e.id,"-").concat(e.date)))})]})}),eC>1&&(0,l.jsx)(a.A,{sx:{mt:4,display:"flex",justifyContent:"start"},children:(0,l.jsx)(y.A,{count:eC,page:ev,onChange:(e,n)=>{ew(n);let s=(n-1)*10;eS($.slice(s,s+10))},color:"primary",size:"medium"})}),(0,l.jsx)(R.A,{open:ea,onClose:()=>{ec(!1),et({}),eh(null),ex("create"),eR()},mode:ed,event:"create"===ed?null:{name:eo.name,description:eo.description,authorId:eo.author.id,meetingRoomId:eo.meetingRoomId,employeeIds:eo.employees.map(e=>e.id),date:null!==(n=eo.originalDate)&&void 0!==n?n:eo.date,timeStart:eo.timeStart,timeEnd:eo.timeEnd,recurrenceType:eo.recurrenceTypeValue,recurrenceInterval:eo.recurrenceInterval,recurrenceEnd:eo.recurrenceEnd},idEvent:"create"===ed?null:eo.id}),(0,l.jsx)(X,{})]})}):null}}}]);